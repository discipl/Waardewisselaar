Type: SubsidieAanvraag
Version: 1.0
Description: Leeraar vraagt een subsidie aan.
Template: {"opleiding":{"type":"hash","desc":"De opleiding waarvoor een subsidie wordt aangevraagt.","name":"Opleiding"},"jaar":{"type":"uint","desc":"Het jaar waarvoor het wordt aangevraagt.","name":"Jaar"}}
Init: YXdhaXQgcXVlcnkoIkNSRUFURSIsICJzdWJzaWRpZXMiLCAiKGRvY2VudCBWQVJDSEFSKDM1KSBOT1QgTlVMTCBSRUZFUkVOQ0VTIGRvY2VudGVuIChpZCksICIgKwogICAgIm9wbGVpZGluZyBCWVRFQSBOT1QgTlVMTCBSRUZFUkVOQ0VTIG9wbGVpZGluZ2VuIChpZCksIGphYXIgSU5UIE5PVCBOVUxMLCBhYW52cmFhZ190aWpkIEJJR0lOVCBOT1QgTlVMTCwgIiArCiAgICAiYmVkcmFnX2NlbnRlbiBJTlQgTk9UIE5VTEwsIHNlY3RvciBWQVJDSEFSKDMyKSBOT1QgTlVMTCwgZ2Vhbm51bGVlcmQgQk9PTEVBTiBOT1QgTlVMTCBERUZBVUxUIGZhbHNlKTsiLCBbXSk7
Code: Ly9LaWprIG9mIGlldHMgYWFuIGFsbGUgKHN1Yil2b29yd2FhcmRlbiB2b2xkb2V0LiBabyBuaWV0IGdlZWYgdGVydWcgYWFuIHdlbGtlIChzdWIpdm9vcndhYXJkZW4gbmlldCB3b3JkdCB2b2xkYWFuLgpjb25zdCBhbmQgPSAoYnJvLCAuLi5hcmdzKSA9PiB7CiAgICBsZXQgdW5rbm93biA9IFtdOyAvL0FsbGVzIHdhdCBub2cgb25iZWtlbmQgaXMuCiAgICBsZXQgcHJvYmxlbXMgPSBbXTsgLy9BbGxlcyB3YWFyIG5pZXQgYWFuIHdvcmR0IHZvbGRhYW4uCiAgICBsZXQgcmVzdWx0ID0gdHJ1ZTsKICAgIGxldCBiYWROb25GdW5jdGlvbiA9IGZhbHNlOwogICAgLy9Wb29yIGFsbGUgYXJndW1lbnRlbiBraWprZW4gb2YgaGV0IGVlbiBzdWJmdW5jdGllIGlzIChkaWUgd29yZHQgdWl0Z2V2b2VyZCkgb2Ygb2YgaGV0IHZvbGRvZXQKICAgIGZvciAobGV0IGFyZyBvZiBhcmdzKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhcmcgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgY29uc3QgYXJnUmVzdWx0ID0gYXJnKCk7CiAgICAgICAgICAgIHVua25vd24ucHVzaCguLi5hcmdSZXN1bHQudW5rbm93bik7CiAgICAgICAgICAgIHByb2JsZW1zLnB1c2goLi4uYXJnUmVzdWx0LnByb2JsZW1zKTsKICAgICAgICAgICAgYXJnID0gYXJnUmVzdWx0LnJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYXJnICE9PSB0cnVlKSB7CiAgICAgICAgICAgIGJhZE5vbkZ1bmN0aW9uID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFyZyA9PT0gdW5kZWZpbmVkICYmIHJlc3VsdCAhPT0gZmFsc2UpIHsgLy9JbmZvcm1hdGllIG9udGJyZWVrdCBub2csIGR1cyBrYW4gbm9nIG5pZXQgZ29lZGtldXJlbgogICAgICAgICAgICByZXN1bHQgPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGFyZyA9PT0gZmFsc2UpIHsgLy9JbmZvcm1hdGllIGdlZWZ0IGFhbiBkYXQgZXIgbmlldCB3b3JkdCB2b2xkYWFuLCBvbmdlYWNodCBkZSByZXN0CiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAvL1dlIHdpbGxlbiBpbiBkZSBmb3V0bWVsZGluZyB3ZWwgYWxsZXMgd2F0IGZvdXQgZ2FhdCwgZHVzIGdhIHZlcmRlcgogICAgICAgIH0KICAgIH0KICAgIC8vR2VlZiBkb29yIGFhbiB3ZWxrZSBvbmRlcmRlbGVuIG5pZXQgd29yZHQgdm9sZGFhbgogICAgaWYgKGJhZE5vbkZ1bmN0aW9uKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHVua25vd24ucHVzaChicm8pOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHByb2JsZW1zLnB1c2goYnJvKTsKICAgICAgICB9CiAgICB9CiAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7CiAgICAgICAgdW5rbm93biA9IFtdOwogICAgICAgIHByb2JsZW1zID0gW107CiAgICB9CiAgICByZXR1cm4geyByZXN1bHQsIHVua25vd24sIHByb2JsZW1zIH07Cn07Ci8vS2lqayBvZiBpZXRzIGFhbiBlZW4gKHN1Yil2b29yd2FhcmRlbiB2b2xkb2V0LiBabyBuaWV0IGdlZWYgdGVydWcgYWFuIHdlbGtlIChzdWIpdm9vcndhYXJkZW4gbmlldCB3b3JkdCB2b2xkYWFuLgpjb25zdCBvciA9IChicm8sIC4uLmFyZ3MpID0+IHsKICAgIGxldCB1bmtub3duID0gW107IC8vQWxsZXMgd2F0IG5vZyBvbmJla2VuZCBpcy4KICAgIGxldCBwcm9ibGVtcyA9IFtdOyAvL0FsbGVzIHdhYXIgbmlldCBhYW4gd29yZHQgdm9sZGFhbi4KICAgIGxldCByZXN1bHQgPSBmYWxzZTsKICAgIGxldCBiYWROb25GdW5jdGlvbiA9IGZhbHNlOwogICAgLy9Wb29yIGFsbGUgYXJndW1lbnRlbiBraWprZW4gb2YgaGV0IGVlbiBzdWJmdW5jdGllIGlzIChkaWUgd29yZHQgdWl0Z2V2b2VyZCkgb2Ygb2YgaGV0IHZvbGRvZXQKICAgIGZvciAobGV0IGFyZyBvZiBhcmdzKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhcmcgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgY29uc3QgYXJnUmVzdWx0ID0gYXJnKCk7CiAgICAgICAgICAgIGFyZyA9IGFyZ1Jlc3VsdC5yZXN1bHQ7CiAgICAgICAgICAgIHVua25vd24ucHVzaCguLi5hcmdSZXN1bHQudW5rbm93bik7CiAgICAgICAgICAgIHByb2JsZW1zLnB1c2goLi4uYXJnUmVzdWx0LnByb2JsZW1zKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYXJnICE9PSB0cnVlKSB7CiAgICAgICAgICAgIGJhZE5vbkZ1bmN0aW9uID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGFyZyA9PT0gdW5kZWZpbmVkKSB7IC8vSW5mb3JtYXRpZSBvbnRicmVla3Qgbm9nLCBkdXMga2FuIG5vZyBuaWV0IGdvZWRrZXVyZW4KICAgICAgICAgICAgcmVzdWx0ID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChhcmcgPT09IHRydWUpIHsgLy9JbmZvcm1hdGllIGdlZWZ0IGFhbiBkYXQgZXIgYWFuIHdvcmR0IHZvbGRhYW4sIG9uZ2VhY2h0IGRlIHJlc3QKICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7IC8vV2Ugd2V0ZW4gYWwgZGF0IGhldCB0b3RhYWwgZ29lZCBpcywgZHVzIGdhIG5pZXQgdmVyZGVyLgogICAgICAgIH0KICAgIH0KICAgIC8vR2VlZiBkb29yIGFhbiB3ZWxrZSBvbmRlcmRlbGVuIG5pZXQgd29yZHQgdm9sZGFhbgogICAgaWYgKGJhZE5vbkZ1bmN0aW9uKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHVua25vd24ucHVzaChicm8pOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChyZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHByb2JsZW1zLnB1c2goYnJvKTsKICAgICAgICB9CiAgICB9CiAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7CiAgICAgICAgdW5rbm93biA9IFtdOwogICAgICAgIHByb2JsZW1zID0gW107CiAgICB9CiAgICByZXR1cm4geyByZXN1bHQsIHVua25vd24sIHByb2JsZW1zIH07Cn07Ci8vS2lqayBvZiBpZXRzIGVyZ2VucyBhYW4gdm9sZG9ldC4KY29uc3QgY29tcGFyZSA9IChicm8sIGNvbXAsIGEsIGIpID0+IHsKICAgIGxldCB1bmtub3duID0gW107IC8vQWxsZXMgd2F0IG5vZyBvbmJla2VuZCBpcy4KICAgIGxldCBwcm9ibGVtcyA9IFtdOyAvL0FsbGVzIHdhYXIgbmlldCBhYW4gd29yZHQgdm9sZGFhbi4KICAgIGxldCByZXN1bHQ7CiAgICBpZiAodHlwZW9mIGEgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBjb25zdCB0ZW1wYSA9IGEoKTsKICAgICAgICBhID0gdGVtcGEucmVzdWx0OwogICAgICAgIHVua25vd24ucHVzaCguLi50ZW1wYS51bmtub3duKTsKICAgICAgICBwcm9ibGVtcy5wdXNoKC4uLnRlbXBhLnByb2JsZW1zKTsKICAgIH0KICAgIGlmICh0eXBlb2YgYiA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGNvbnN0IHRlbXBiID0gYigpOwogICAgICAgIGIgPSB0ZW1wYi5yZXN1bHQ7CiAgICAgICAgdW5rbm93bi5wdXNoKC4uLnRlbXBiLnVua25vd24pOwogICAgICAgIHByb2JsZW1zLnB1c2goLi4udGVtcGIucHJvYmxlbXMpOwogICAgfQogICAgaWYgKGEgIT09IHVuZGVmaW5lZCAmJiBiICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXN1bHQgPSBjb21wKGEsIGIpOwogICAgfQogICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkgewogICAgICAgIHVua25vd24gPSBbXTsKICAgICAgICBwcm9ibGVtcyA9IFtdOwogICAgfQogICAgZWxzZSBpZiAocmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgIHByb2JsZW1zLnB1c2goYnJvKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHVua25vd24ucHVzaChicm8pOwogICAgfQogICAgcmV0dXJuIHsgcmVzdWx0LCB1bmtub3duLCBwcm9ibGVtcyB9Owp9OwppZiAocGF5bG9hZC5qYWFyID4gMjE0NzQ4MzY0NykgewogICAgcmV0dXJuICJPbmdlbGRpZyBqYWFyLiI7Cn0KLy9PcGxlaWRpbmcgZGllIHdvcmR0IGFhbmdldnJhYWd0CmNvbnN0IGJpbmFyeU9wbGVpZGluZyA9IEJ1ZmZlci5mcm9tKHBheWxvYWQub3BsZWlkaW5nLCAiaGV4Iik7CmNvbnN0IHN0dWRpZSA9IChhd2FpdCBxdWVyeSgiU0VMRUNUIiwgIm9wbGVpZGluZ2VuIiwgIldIRVJFIGlkID0gJDE7IiwgW2JpbmFyeU9wbGVpZGluZ10pKS5yb3dzWzBdOwppZiAoc3R1ZGllID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiAiQWFuZ2V2cmFhZ2RlIG9wbGVpZGluZyBiZXN0YWF0IG5pZXQuIjsKfQovL0RlIGFhbnZyYWdlcgpjb25zdCBhYW52cmFnZXIgPSAoYXdhaXQgcXVlcnkoIlNFTEVDVCIsICJkb2NlbnRlbiIsICJXSEVSRSBpZCA9ICQxOyIsIFtmcm9tXSkpLnJvd3NbMF07CmlmIChhYW52cmFnZXIgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuICJWcmFhZyB1dyAoZXgtKXdlcmtnZXZlciBvbSB1IGFscyBsZXJhYXIgdG9lIHRlIHZvZWdlbiBvbSBlZW4gc3Vic2lkaWVhYW52cmFhZyB0ZSBrdW5uZW4gZG9lbi4iOwp9Ci8vQWxsZSBzdWJzaWRpZXMgZGllIGplIGhlYnQgYWFuZ2V2cmFhZ3QgKGV4Y2x1c2llZiBodWlkaWdlIGFhbnZyYWFnIGVuIGdlYW5ubnVsZWVyZGUgYWFudnJhZ2VuKQpjb25zdCBzdWJzaWRpZXMgPSAoYXdhaXQgcXVlcnkoIlNFTEVDVCIsICJzdWJzaWRpZXMiLCAiSk9JTiBvcGxlaWRpbmdlbiBPTiAiICsKICAgICJzdWJzaWRpZXMub3BsZWlkaW5nID0gb3BsZWlkaW5nZW4uaWQgV0hFUkUgZG9jZW50ID0gJDEgQU5EIGdlYW5udWxlZXJkID0gZmFsc2U7IiwgW2Zyb21dKSkucm93czsKLy9BbGxlIHN1YnNpZGllcyB2b29yIGRlIGh1aWRpZ2Ugb3BsZWlkaW5nIGdlc29ydGVlcmQgb3AgamFhcgpjb25zdCBodWlkaWdlU3Vic2lkaWVzID0gc3Vic2lkaWVzCiAgICAuZmlsdGVyKChzdWJzaWRpZSkgPT4gc3Vic2lkaWUub3BsZWlkaW5nLmVxdWFscyhiaW5hcnlPcGxlaWRpbmcpKQogICAgLnNvcnQoKHN1YnNpZGllMSwgc3Vic2lkaWUyKSA9PiBzdWJzaWRpZTEuamFhciAtIHN1YnNpZGllMi5qYWFyKTsKY29uc3QgdmVydm9sZ0FhbnZyYWFnID0gaHVpZGlnZVN1YnNpZGllcy5sZW5ndGggIT09IDA7Ci8vQWxsZSBvdWRlIHN1YnNpZGllcyBlbiBvcGxlaWRpbmdlbgpjb25zdCBvdWRlU3Vic2lkaWVzID0gc3Vic2lkaWVzLmZpbHRlcigoc3Vic2lkaWUpID0+ICFzdWJzaWRpZS5vcGxlaWRpbmcuZXF1YWxzKGJpbmFyeU9wbGVpZGluZykpOwpjb25zdCBhYW50YWxPdWRlT3BsZWlkaW5nZW4gPSBuZXcgU2V0KG91ZGVTdWJzaWRpZXMubWFwKChvdWRlU3Vic2lkaWUpID0+IG91ZGVTdWJzaWRpZS5vcGxlaWRpbmcpKS5zaXplOwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gQjAwNAovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KY29uc3Qgc3R1ZGllVm9sZG9ldCA9ICgpID0+IGFuZCgiQjAwNC5CUjAxIiwgc3R1ZGllVm9sZG9ldE9wbGVpZGluZ3Nzb29ydCwgLy9CMDA0LkJSMDEuMQpzdHVkaWVKdWlzdGVMYW5kLCAvL0IwMDQuQlIwMS4yCnN0dWRpZUp1aXN0ZVN0YXR1cyAvL0IwMDQuQlIwMS4zCik7CmNvbnN0IHN0dWRpZVZvbGRvZXRPcGxlaWRpbmdzc29vcnQgPSAoKSA9PiBvcigiQjAwNC5CUjAyIiwgc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uYmFjaGVsb3IsIC8vQjAwNC5CUjAyLjEKc3R1ZGllLmVpZ2Vuc2NoYXBwZW4ubWFzdGVyLCAvL0IwMDQuQlIwMi4yCnN0dWRpZS5laWdlbnNjaGFwcGVuLmRlZmljacOrbnRpZW9wbGVpZGluZyAvL0IwMDQuQlIwMi4zCik7CmNvbnN0IHN0dWRpZUp1aXN0ZUxhbmQgPSAoKSA9PiBvcigiQjAwNC5CUjAzIiwgc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uaW5OZWRlcmxhbmQsIC8vQjAwNC5CUjAzLjEKc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uaW5FVSwgLy9CMDA0LkJSMDMuMgpzdHVkaWUuZWlnZW5zY2hhcHBlbi5pbkFydWJhLCAvL0IwMDQuQlIwMy4zCnN0dWRpZS5laWdlbnNjaGFwcGVuLmluU2ludE1hYXJ0ZW4sIC8vQjAwNC5CUjAzLjQKc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uaW5DdXJhw6dhbyAvL0IwMDQuQlIwMy41Cik7CmNvbnN0IHN0dWRpZUp1aXN0ZVN0YXR1cyA9ICgpID0+IG9yKCJCMDA0LkJSMDQiLCBzdHVkaWUuZWlnZW5zY2hhcHBlbi5OdWZmaWNHZWxpamt3YWFyZGlnVmVya2xhYXJkZUJ1aXRlbmxhbmRzLCAvL0IwMDQuQlIwNC4xCnN0dWRpZS5laWdlbnNjaGFwcGVuLk5WT2dlYWNjcmVkaXRlZXJkIC8vQjAwNC5CUjA0LjIKKTsKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEIwMDMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmNvbnN0IHZvb3J3YWFyZGVuQWFudGFsS2VlclN1YnNpZGllQWFuZ2V2cmFhZ2QgPSAoKSA9PiB7CiAgICByZXR1cm4gYW5kKCJCMDAzLkJSMDEiLCAoKSA9PiBjb21wYXJlKCJCMDAzLkJSMDEuMSIsIChhLCBiKSA9PiBhID4gYiwgbWF4aW1hYWxTdWJzaWVkaWVKYXJlbiwgYWFudGFsVmVyc3RyZWtlblN1YnNpZGllamFyZW4oKSksICgpID0+IGNvbXBhcmUoIkIwMDMuQlIwMS4yIiwgKGEsIGIpID0+IGEgPD0gYiwgcGF5bG9hZC5qYWFyLCB1aXRlcnN0ZVN1YnNpZGllamFhciksIG1heGltYWFsT3BsZWlkaW5nZW5TdWJzaWRpZSwgLy9CMDAzLkJSMDEuMwogICAgc3Vic2lkaWVzLmZpbmQoKHN1YnNpZGllKSA9PiBzdWJzaWRpZS5qYWFyID09PSBwYXlsb2FkLmphYXIpID09PSB1bmRlZmluZWQpOyAvL1RvZXZvZWdpbmc6IE1hZyAxIHN1YnNpZGllIHBlciBqYWFyCn07CmNvbnN0IG1heGltYWFsU3Vic2llZGllSmFyZW4gPSAoKSA9PiB7CiAgICBsZXQgcmVzdWx0OwogICAgaWYgKHN0dWRpZS5laWdlbnNjaGFwcGVuLkVDICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uRUMgPj0gMzAgJiYgc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uRUMgPCA2MCkgewogICAgICAgICAgICByZXN1bHQgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzdHVkaWUuZWlnZW5zY2hhcHBlbi5FQyA9PT0gNjApIHsKICAgICAgICAgICAgcmVzdWx0ID0gMjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uRUMgPiA2MCkgewogICAgICAgICAgICByZXN1bHQgPSAzOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gMDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyByZXN1bHQsIHVua25vd246IHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gWyJCMDAzLkJSMDIiXSA6IFtdLCBwcm9ibGVtczogW10gfTsKfTsKY29uc3QgYWFudGFsVmVyc3RyZWtlblN1YnNpZGllamFyZW4gPSAoKSA9PiBodWlkaWdlU3Vic2lkaWVzLmZpbHRlcigoc3Vic2lkaWUpID0+IGFuZCgiQjAwMy5CUjAzIiwgKCkgPT4gc3Vic2lkaWVJc1RvZWdla2VudChzdWJzaWRpZSksIC8vQjAwMy5CUjAzLjEKKCkgPT4gc3Vic2lkaWVJc1ZlcmJydWlrdChzdWJzaWRpZSkgLy9CMDAzLkJSMDMuMgopKS5sZW5ndGg7CmNvbnN0IHN1YnNpZGllSXNUb2VnZWtlbnQgPSAoc3Vic2lkaWUpID0+IG9yKCJCMDAzLkJSMDQiLCBzdWJzaWRpZSAhPT0gdW5kZWZpbmVkLCAvL0IwMDMuQlIwNC4xLCBzdWJzaWRpZXMgd29yZGVuIGdlbGlqayB0b2VnZWtlbnQgZHVzIGJla2lqayB0b2VnZWtlbmRlIHN1YnNpZGllcwpvdWRlU3Vic2lkaWVzLnNvbWUoKG9wbGVpZGluZykgPT4gb3BsZWlkaW5nLmVpZ2Vuc2NoYXBwZW4uZGVmaWNpw6tudGllb3BsZWlkaW5nID09PSB0cnVlKSAvL0IwMDMuQlIwNC4yCik7CmNvbnN0IHN1YnNpZGllSXNWZXJicnVpa3QgPSAoc3Vic2lkaWUpID0+IGFuZCgiQjAwMy5CUjA1Iiwgc3Vic2lkaWUgIT09IHVuZGVmaW5lZCwgLy9CMDAzLkJSMDUuMSwgc3Vic2lkaWVzIHdvcmRlbiBnZWxpamsgdG9lZ2VrZW50IGR1cyBiZWtpamsgdG9lZ2VrZW5kZSBzdWJzaWRpZXMKIXN1YnNpZGllLmdlYW5udWxlZXJkIC8vQjAwMy5CUjA1LjIsIHdlIHNlbGVjdGVyZW4gYWwgZ2VlbiBnZWFubnVsZWVyZGUgYWFudnJhZ2VuIHdhbnQgJ2RlemUgaGViYmVuIG5vb2l0IHBsYWF0c2dldm9uZGVuJwopOwpjb25zdCB1aXRlcnN0ZVN1YnNpZGllamFhciA9ICgpID0+IHsKICAgIGNvbnN0IHBlcmlvZGUgPSBiZXVyc3BlcmlvZGUoKTsKICAgIGlmIChwZXJpb2RlLnJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHBlcmlvZGU7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBjb25zdCByZXN1bHQgPSAodmVydm9sZ0FhbnZyYWFnID8gaHVpZGlnZVN1YnNpZGllc1swXS5qYWFyIDogcGF5bG9hZC5qYWFyKSAvL0IwMDMuQlIwNi4xCiAgICAgICAgICAgICsgcGVyaW9kZS5yZXN1bHQ7IC8vQjAwMy5CUjA2LjIKICAgICAgICByZXR1cm4geyByZXN1bHQsIHVua25vd246IFtdLCBwcm9ibGVtczogW10gfTsKICAgIH0KfTsKY29uc3QgYmV1cnNwZXJpb2RlID0gKCkgPT4gewogICAgbGV0IHJlc3VsdDsKICAgIGlmIChzdHVkaWUuZWlnZW5zY2hhcHBlbi5FQyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKHN0dWRpZS5laWdlbnNjaGFwcGVuLkVDID49IDMwICYmIHN0dWRpZS5laWdlbnNjaGFwcGVuLkVDIDwgNjApIHsKICAgICAgICAgICAgcmVzdWx0ID0gMDsgLy9IaWVyIGhlYiBqZSBlZW4gb2ZmLWJ5LW9uZSBlcnJvciBhbHMgamUgaGV0IHNjaGVtYSB2b2xndAogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChzdHVkaWUuZWlnZW5zY2hhcHBlbi5FQyA9PT0gNjApIHsKICAgICAgICAgICAgcmVzdWx0ID0gMzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoc3R1ZGllLmVpZ2Vuc2NoYXBwZW4uRUMgPiA2MCkgewogICAgICAgICAgICByZXN1bHQgPSA1OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gMDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyByZXN1bHQsIHVua25vd246IHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gWyJCMDAzLkJSMDciXSA6IFtdLCBwcm9ibGVtczogW10gfTsKfTsKY29uc3QgbWF4aW1hYWxPcGxlaWRpbmdlblN1YnNpZGllID0gKCkgPT4gb3IoIkIwMDMuQlIwOCIsIGFhbnRhbE91ZGVPcGxlaWRpbmdlbiA9PT0gMCwgLy9CMDAzLkJSMDguMQovL0FscyBoZXQgYWFudGFsIG91ZGUgb3BsZWlkaW5nZW4gMSBpcyBnYWFuIGFsbGUgb3VkZSBzdWJzaWRpZXMgb3ZlciBkZXplbGZkZSBvcGxlaWRpbmcsIGR1cyBwYWsgZ2V3b29uIGRlIGVlcnN0ZQphYW50YWxPdWRlT3BsZWlkaW5nZW4gIT09IDEgPyBmYWxzZSA6IHN0dWRpZS5laWdlbnNjaGFwcGVuLm1hc3RlciA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDoKICAgIHN0dWRpZS5laWdlbnNjaGFwcGVuLm1hc3RlciAmJiBvdWRlU3Vic2lkaWVzWzBdLmVpZ2Vuc2NoYXBwZW4uYmFjaGVsb3IsIC8vQjAwMy5CUjA4LjIKYWFudGFsT3VkZU9wbGVpZGluZ2VuICE9PSAxID8gZmFsc2UgOiBzdHVkaWUuZWlnZW5zY2hhcHBlbi5tYXN0ZXIgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6CiAgICBzdHVkaWUuZWlnZW5zY2hhcHBlbi5tYXN0ZXIgJiYgb3VkZVN1YnNpZGllc1swXS5laWdlbnNjaGFwcGVuLmRlZmljacOrbnRpZW9wbGVpZGluZywgLy9CMDAzLkJSMDguMwpmYWxzZSAvL0IwMDMuQlIwOC40IHdvcmR0IG5pZXQgbWVlZ2Vub21lbiwgemllIGlzc3VlICM1MAopOwovL0IwMDMuQlIwOSAmIEIwMDMuQlIxMCB3b3JkZW4gbmlldCBtZWVnZW5vbWVuLCB6aWUgaXNzdWUgIzUwCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBCMDAyCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpjb25zdCBjb3JyZWN0ZUFhbnZyYWdlciA9ICgpID0+IGFuZCgiQjAwMi5CUjAxIiwgYWFudnJhZ2VyLmVpZ2Vuc2NoYXBwZW4udm9sZG9ldEFhbkJldm9lZ2RoZWlkc2Vpc2VuLCAvL0IwMDIuQlIwMS4xCmFhbnZyYWdlci5laWdlbnNjaGFwcGVuLmdyYWFkQmFjaGFsb3JWb2VyZW4sIC8vQjAwMi5CUjAxLjIKdm9vcndhYXJkZW5EaWVuc3R2ZXJiYW5kLCAvL0IwMDIuQlIwMS4zCnZvb3J3YWFyZGVuQWFudGFsS2VlclN1YnNpZGllQWFuZ2V2cmFhZ2QsIC8vQjAwMi5CUjAxLjQKdm9vcndhYXJkZW5XZXJremFhbWhlZGVuIC8vQjAwMi5CUjAxLjUKKTsKY29uc3QgdHdhYWxmTWFhbmRlblRlcnVnID0gbmV3IERhdGUocHJldmlvdXNCbG9ja1RpbWVzdGFtcCk7CnR3YWFsZk1hYW5kZW5UZXJ1Zy5zZXRVVENNb250aCh0d2FhbGZNYWFuZGVuVGVydWcuZ2V0VVRDTW9udGgoKSAtIDEyKTsKaWYgKGFhbnZyYWdlci5laWdlbnNjaGFwcGVuLnZlcmxlZGVuRGllbnN0dmVyYmFuZGVuID09PSB1bmRlZmluZWQpIHsKICAgIGFhbnZyYWdlci5laWdlbnNjaGFwcGVuLnZlcmxlZGVuRGllbnN0dmVyYmFuZGVuID0gW107Cn0KY29uc3QgYWZnZWxvcGVuMTJNYWFuZGVuV2Vya2dldmVycyA9IGFhbnZyYWdlci5laWdlbnNjaGFwcGVuLnZlcmxlZGVuRGllbnN0dmVyYmFuZGVuLmZpbHRlcigoZGllbnN0VmVyYmFuZCkgPT4gZGllbnN0VmVyYmFuZC5laW5kRGF0dW0gPiB0d2FhbGZNYWFuZGVuVGVydWcuZ2V0VGltZSgpKTsgLy9CMDAyLkJSMDQuMgpjb25zdCB2b29yd2FhcmRlbkRpZW5zdHZlcmJhbmQgPSAoKSA9PiBvcigiQjAwMi5CUjAyIiwgLy9aZWxmZGUgYWxzIEIwMDIuQlIwNCwgemllIGlzc3VlICM1MQphYW52cmFnZXIud2Vya2dldmVyICE9PSBudWxsLCAvL0IwMDIuQlIwMi4xCmFmZ2Vsb3BlbjEyTWFhbmRlbldlcmtnZXZlcnMubGVuZ3RoID4gMCAvL0IwMDIuQlIwMi4yCik7CmNvbnN0IGFsbGVXZXJrZ2V2ZXJzID0gYWZnZWxvcGVuMTJNYWFuZGVuV2Vya2dldmVycy5tYXAoKGRpZW5zdHZlcmJhbmQpID0+IGRpZW5zdHZlcmJhbmQud2Vya2dldmVyKTsKaWYgKGFhbnZyYWdlci53ZXJrZ2V2ZXIgIT09IG51bGwpIHsKICAgIGFsbGVXZXJrZ2V2ZXJzLnB1c2goYWFudnJhZ2VyLndlcmtnZXZlcik7Cn0KY29uc3Qgd2Vya2dldmVycyA9IChhd2FpdCBxdWVyeSgiU0VMRUNUIiwgInNjaG9sZW4iLCAiV0hFUkUgaWQgPSBBTlkoJDEpOyIsIFthbGxlV2Vya2dldmVyc10pKS5yb3dzOwpjb25zdCB2b29yd2FhcmRlbldlcmt6YWFtaGVkZW4gPSAoKSA9PiBhbmQoIkIwMDIuQlIwMyIsIHZvb3J3YWFyZGVuUmVjZW50ZVdlcmt6YWFtaGVkZW4sIC8vQjAwMi5CUjAzLjEKdm9vcndhYXJkZW5XZXJraW5kZWxpbmcsIC8vQjAwMi5CUjAzLjIKLy9XZSBraWprZW4gb2YgZXIgbWluaW1hYWwgMSB2b2xkb2V0LCBnZXppZW4gZGUgJ29uZGVyd2lqc1dlcmtnZXZlcicgbmFhciBtZWVyZGVyZSBrYW4gdmVyd2lqemVuCigpID0+IG9yKCJCMDAyLkJSMDgiLCAuLi53ZXJrZ2V2ZXJzLm1hcCgod2Vya2dldmVyKSA9PiBvbmRlcndpanNXZXJrZ2V2ZXJWb2xkb2V0KHdlcmtnZXZlcikpKSAvL0IwMDIuQlIwMy4zCik7CmNvbnN0IHZvb3J3YWFyZGVuUmVjZW50ZVdlcmt6YWFtaGVkZW4gPSAoKSA9PiBvcigiQjAwMi5CUjA0IiwgYWFudnJhZ2VyLndlcmtnZXZlciAhPT0gbnVsbCwgLy9CMDAyLkJSMDQuMQphZmdlbG9wZW4xMk1hYW5kZW5XZXJrZ2V2ZXJzLmxlbmd0aCA+IDAgLy9CMDAyLkJSMDQuMgopOwpjb25zdCB2b29yd2FhcmRlbldlcmtpbmRlbGluZyA9ICgpID0+IG9yKCJCMDAyLkJSMDUiLCB2b29yd2FhcmRlbldlcmt0aWpkLCAvL0IwMDIuQlIwNS4xCnVpdGdlem9uZGVyZGVGdW5jdGllIC8vQjAwMi5CUjA1LjIKKTsKY29uc3Qgdm9vcndhYXJkZW5XZXJrdGlqZCA9ICgpID0+IGFuZCgiQjAwMi5CUjA2IiwgYWFudnJhZ2VyLmVpZ2Vuc2NoYXBwZW4udHdpbnRpZ1Byb2NlbnRMZXNnZWJvbmRlblRha2VuLCAvL0IwMDIuQlIwNi4xCmFhbnZyYWdlci5laWdlbnNjaGFwcGVuLnBlZGFnb2dpc2NoRGlkYWN0aXNjaFZlcmFudHdvb3JkZWxpamsgLy9CMDAyLkJSMDYuMgopOwpjb25zdCB1aXRnZXpvbmRlcmRlRnVuY3RpZSA9ICgpID0+IG9yKCJCMDAyLkJSMDciLCBhYW52cmFnZXIuZWlnZW5zY2hhcHBlbi5hbWJ1bGFudEJlZ2VsZWlkZXIsIC8vQjAwMi5CUjA3LjEKYWFudnJhZ2VyLmVpZ2Vuc2NoYXBwZW4uem9yZ2Nvw7ZyZGluYXRvciwgLy9CMDAyLkJSMDcuMgphYW52cmFnZXIuZWlnZW5zY2hhcHBlbi5pbnRlcm5lQmVnZWxlaWRlciwgLy9CMDAyLkJSMDcuMwphYW52cmFnZXIuZWlnZW5zY2hhcHBlbi5yZW1lZGlhbFRlYWNoZXIgLy9CMDAyLkJSMDcuNAopOwpjb25zdCBvbmRlcndpanNXZXJrZ2V2ZXJWb2xkb2V0ID0gKHdlcmtnZXZlcikgPT4gLy9CMDAyLkJSMDggd29yZCBhbCBpbiBTY2hvb2xBYW5wYXNzZW4gZ2VkYWFuLCBjb250cm9sZWVyIGhpZXIgYWxsZWVuIGhldCByZXN1bHRhYXQKIHdlcmtnZXZlci5sYWF0c3Rfdm9sZGVlZCAhPT0gbnVsbCAmJiAoIC8vRGV6ZSB3ZXJrZ2V2ZXIgaGVlZnQgb29pdCB2b2xkYWFuCndlcmtnZXZlci5sYWF0c3Rfdm9sZGVlZCA+PSB0d2FhbGZNYWFuZGVuVGVydWcuZ2V0VGltZSgpIHx8IC8vRGl0IHdhcyBpbiBkZSBhZmdlbG9wZW4gMTIgbWFhbmRlbgogICAgd2Vya2dldmVyLmxhYXRzdF92b2xkZWVkID4gd2Vya2dldmVyLmxhYXRzdF9uaWV0X3ZvbGRlZWQpOyAvL09mIGlzIG5vZyBzdGVlZHMgaGV0IGdldmFsCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBCMDA2Ci8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpsZXQgbWF4U3Vic2lkaWVCZWRyYWdDZW50ZW47Ci8vQjAwNi5CUjA1OiBLYW4gcGVyIGphYXIgYmVkcmFnIGluc3RlbGxlbgpjb25zdCBtYXhUZVZlcmdvZWRlbkNvbGxlZ2VnZWxkID0gKGF3YWl0IHF1ZXJ5KCJTRUxFQ1QiLCAibWF4X3ZlcmdvZWRfY29sbGVnZWdlbGQiLCAiV0hFUkUgamFhciA9ICQxOyIsIFtwYXlsb2FkLmphYXJdKSkucm93c1swXTsKaWYgKG1heFRlVmVyZ29lZGVuQ29sbGVnZWdlbGQgIT09IHVuZGVmaW5lZCAmJiBzdHVkaWUuZWlnZW5zY2hhcHBlbi5jb2xsZWdlR2VsZENlbnRlbiAhPT0gdW5kZWZpbmVkKSB7CiAgICBjb25zdCBtYXhDb2xsZWdlR2VsZENlbnRlbiA9IE1hdGgubWluKC8vQjAwNi5CUjIKICAgIHN0dWRpZS5laWdlbnNjaGFwcGVuLmNvbGxlZ2VHZWxkQ2VudGVuLCAvL0IwMDYuQlIyLjEKICAgIG1heFRlVmVyZ29lZGVuQ29sbGVnZWdlbGQuYmVkcmFnX2NlbnRlbiAvL0IwMDYuQlIyLjIKICAgICk7CiAgICBjb25zdCBwZXJjZW50YWdlQ29sbGVnZWdlbGQgPSAxMDsgLy9CMDA2LkJSOQogICAgY29uc3QgdmFyaWFibGVWZXJnb2VkaW5nQ2VudGVuID0gTWF0aC5yb3VuZCgvL0IwMDYuQlI2CiAgICBzdHVkaWUuZWlnZW5zY2hhcHBlbi5jb2xsZWdlR2VsZENlbnRlbiAqIC8vQjAwNi5CUjYuMQogICAgICAgIHBlcmNlbnRhZ2VDb2xsZWdlZ2VsZCAvIDEwMCk7IC8vQjAwNi5CUjYuMgogICAgY29uc3QgbWF4VmVyZ29lZGVSZWlza29zdGVuQ2VudGVuID0gMzUwICogMTAwOyAvL0IwMDYuQlI4CiAgICBjb25zdCBtYXhSZWlza29zdGVuQ2VudGVuID0gTWF0aC5taW4oLy9CMDA2LkJSNAogICAgdmFyaWFibGVWZXJnb2VkaW5nQ2VudGVuLCAvL0IwMDYuQlI0LjEKICAgIG1heFZlcmdvZWRlUmVpc2tvc3RlbkNlbnRlbiAvL0IwMDYuQlI0LjIKICAgICk7CiAgICBjb25zdCBtYXhWZXJnb2VkZVN0dWRpZW1pZGRlbGVuQ2VudGVuID0gMzUwICogMTAwOyAvL0IwMDYuQlI3CiAgICBjb25zdCBtYXhTdHVkaWVNaWRkZWxlbkNlbnRlbiA9IE1hdGgubWluKC8vQjAwNi5CUjMKICAgIHZhcmlhYmxlVmVyZ29lZGluZ0NlbnRlbiwgLy9CMDA2LkJSMy4xCiAgICBtYXhWZXJnb2VkZVN0dWRpZW1pZGRlbGVuQ2VudGVuIC8vQjAwNi5CUjMuMgogICAgKTsKICAgIG1heFN1YnNpZGllQmVkcmFnQ2VudGVuID0gbWF4Q29sbGVnZUdlbGRDZW50ZW4gKyBtYXhSZWlza29zdGVuQ2VudGVuICsgbWF4U3R1ZGllTWlkZGVsZW5DZW50ZW47IC8vQjAwNi5CUjE7Cn0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEIxMDEKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vQjAwMS5CUjAxOiBiZXNjaGlrYmFyZSBidWRnZXQgYmVnaW50IGFscyBzdWJzaWRpZXBsYWZvbmQsIHdvcmR0IHRlbGtlbnMgdmVybGFhZ3QgYWxzIHN1YnNpZGllIHdvcmR0IHRvZWdla2VudApjb25zdCBidWRnZXQgPSAoYXdhaXQgcXVlcnkoIlNFTEVDVCIsICJidWRnZXQiLCAiV0hFUkUgamFhciA9ICQxIEFORCBzZWN0b3IgPSAkMjsiLCBbcGF5bG9hZC5qYWFyLCBhYW52cmFnZXIuZWlnZW5zY2hhcHBlbi5zZWN0b3JdKSkucm93c1swXTsKY29uc3QgYmVzY2hpa2JhcmVCdWRnZXRDZW50ZW4gPSAoKSA9PiB7CiAgICBsZXQgcmVzdWx0OwogICAgaWYgKGJ1ZGdldCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKHZlcnZvbGdBYW52cmFhZykgewogICAgICAgICAgICAvL0lzIGVlbiB2ZXJ2b2xnIGFhbnZyYWFnLCB2b2xsZWRpZ2UgYnVkZ2V0IGlzIGJlc2NoaWtiYWFyICgtIHdhdCBpcyB1aXRnZWdldmVuKQogICAgICAgICAgICByZXN1bHQgPSBidWRnZXQuYmVzY2hpa2JhYXJfdG90YWFsX2NlbnRlbiAtIGJ1ZGdldC51aXRnZWdldmVuX3RvdGFhbF9jZW50ZW47CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvL0lzIGVlbiBuaWV1d2UgYWFudnJhYWcsIHZlcnZvbGcgYnVkZ2V0IHZhbiBoZXQgdG90YWFsIGFmIGhhbGVuCiAgICAgICAgICAgIHJlc3VsdCA9IChidWRnZXQuYmVzY2hpa2JhYXJfdG90YWFsX2NlbnRlbiAtIGJ1ZGdldC5iZXNjaGlrYmFhcl92ZXJ2b2xnX2NlbnRlbikgLQogICAgICAgICAgICAgICAgLy9HZWRlZWx0ZSB3YXQgbmlldCBhbCBpcyB1aXRnZWdldmVuLCBtYWFyIGFsbGVlbiB2b29yIHZlcnZvbGcgYmVzY2hpa2JhYXIgaXMuCiAgICAgICAgICAgICAgICAoYnVkZ2V0LnVpdGdlZ2V2ZW5fdG90YWFsX2NlbnRlbiAtIGJ1ZGdldC51aXRnZWdldmVuX3ZlcnZvbGdfY2VudGVuKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyByZXN1bHQsIHVua25vd246IHJlc3VsdCA9PT0gdW5kZWZpbmVkID8gWyJCMDAxLkJSMDEiXSA6IFtdLCBwcm9ibGVtczogW10gfTsKfTsKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIFJlc3VsdGFhdAovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy9MYXRlciB6YWwgaGllciBub2cgZWVuIGNoZWNrIGJpaiBtb2V0ZW4gb2YgZXIgbm9nIGdlbm9lZyBnZWxkIGJlc2NoaWtiYWFyIGlzLCBldGMuCmNvbnN0IHRvZXdpanplbiA9IGFuZCgiQjAwOC5CUjAyIiwgcGF5bG9hZC5qYWFyID49IG5ldyBEYXRlKHByZXZpb3VzQmxvY2tUaW1lc3RhbXApLmdldFVUQ0Z1bGxZZWFyKCksIC8vQjAwOC5CUjAyLjE6IEIwMDEKY29ycmVjdGVBYW52cmFnZXIsIC8vQjAwOC5CUjAyLjI6IEIwMDIKc3R1ZGllVm9sZG9ldCwgLy9CMDA4LkJSMDIuMzogQjAwNAovL0IwMDguQlIwMi40OiBBbmRlcmUgcmVnZWxpbmcgd29yZHQgbmlldCBtZWVnZW5vbWVuLCB6aWUgaXNzdWUgIzUwCigpID0+IGNvbXBhcmUoIkIwMDguQlIwMi41IiwgKGEsIGIpID0+IGEgPj0gYiwgYmVzY2hpa2JhcmVCdWRnZXRDZW50ZW4sIG1heFN1YnNpZGllQmVkcmFnQ2VudGVuKSAvL0IwMDguQlIwMi41OiBCMDA2ICYgQjEwMQopOwppZiAodG9ld2lqemVuLnJlc3VsdCA9PT0gZmFsc2UpIHsKICAgIC8vRGUgYWFudnJhYWcgaXMgYWZnZXdlemVuIG9tIGRlIHZvbGdlbmRlIHJlZGVuZW46CiAgICByZXR1cm4gYEFmZ2V3ZXplbjogJHtBcnJheS5mcm9tKG5ldyBTZXQodG9ld2lqemVuLnByb2JsZW1zKSkudG9TdHJpbmcoKX1gOwp9CmVsc2UgaWYgKHRvZXdpanplbi5yZXN1bHQgPT09IHVuZGVmaW5lZCkgewogICAgLy9EZSB2b2xnZW5kZSBpbmZvcm1hdGllIGlzIG5vZyBvbmJla2VuZCwgZHVzIGthbiBub2cgbmlldCB3b3JkZW4gZ29lZGdla2V1cmQ6CiAgICByZXR1cm4gYE9udGJyZWVrdDogJHtBcnJheS5mcm9tKG5ldyBTZXQodG9ld2lqemVuLnVua25vd24pKS50b1N0cmluZygpfWA7Cn0KZWxzZSB7CiAgICAvL0RlIGFhbnZyYWFnIGlzIGdvZWRnZWtldXJkCiAgICBhd2FpdCBxdWVyeSgiSU5TRVJUIiwgInN1YnNpZGllcyIsICIoZG9jZW50LCBvcGxlaWRpbmcsIGphYXIsIGFhbnZyYWFnX3RpamQsIGJlZHJhZ19jZW50ZW4sIHNlY3RvcikgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2KTsiLCBbZnJvbSwgYmluYXJ5T3BsZWlkaW5nLCBwYXlsb2FkLmphYXIsIHByZXZpb3VzQmxvY2tUaW1lc3RhbXAsIG1heFN1YnNpZGllQmVkcmFnQ2VudGVuLCBhYW52cmFnZXIuZWlnZW5zY2hhcHBlbi5zZWN0b3JdKTsKICAgIGF3YWl0IHF1ZXJ5KCJVUERBVEUiLCAiYnVkZ2V0IiwgIlNFVCB1aXRnZWdldmVuX3RvdGFhbF9jZW50ZW4gPSB1aXRnZWdldmVuX3RvdGFhbF9jZW50ZW4gKyAkMywgIiArCiAgICAgICAgInVpdGdlZ2V2ZW5fdmVydm9sZ19jZW50ZW4gPSBHUkVBVEVTVCh1aXRnZWdldmVuX3ZlcnZvbGdfY2VudGVuICsgJDQsIGJlc2NoaWtiYWFyX3ZlcnZvbGdfY2VudGVuKSBXSEVSRSBqYWFyID0gJDEgQU5EIHNlY3RvciA9ICQyOyIsIFtwYXlsb2FkLmphYXIsIGFhbnZyYWdlci5laWdlbnNjaGFwcGVuLnNlY3RvciwgbWF4U3Vic2lkaWVCZWRyYWdDZW50ZW4sIHZlcnZvbGdBYW52cmFhZyA/IG1heFN1YnNpZGllQmVkcmFnQ2VudGVuIDogMF0pOwogICAgcmV0dXJuICJPSyI7Cn0=

Init as text:
await query("CREATE", "subsidies", "(docent VARCHAR(35) NOT NULL REFERENCES docenten (id), " +
    "opleiding BYTEA NOT NULL REFERENCES opleidingen (id), jaar INT NOT NULL, aanvraag_tijd BIGINT NOT NULL, " +
    "bedrag_centen INT NOT NULL, sector VARCHAR(32) NOT NULL, geannuleerd BOOLEAN NOT NULL DEFAULT false);", []);
Code as text:
//Kijk of iets aan alle (sub)voorwaarden voldoet. Zo niet geef terug aan welke (sub)voorwaarden niet wordt voldaan.
const and = (bro, ...args) => {
    let unknown = []; //Alles wat nog onbekend is.
    let problems = []; //Alles waar niet aan wordt voldaan.
    let result = true;
    let badNonFunction = false;
    //Voor alle argumenten kijken of het een subfunctie is (die wordt uitgevoerd) of of het voldoet
    for (let arg of args) {
        if (typeof arg === "function") {
            const argResult = arg();
            unknown.push(...argResult.unknown);
            problems.push(...argResult.problems);
            arg = argResult.result;
        }
        else if (arg !== true) {
            badNonFunction = true;
        }
        if (arg === undefined && result !== false) { //Informatie ontbreekt nog, dus kan nog niet goedkeuren
            result = undefined;
        }
        else if (arg === false) { //Informatie geeft aan dat er niet wordt voldaan, ongeacht de rest
            result = false;
            //We willen in de foutmelding wel alles wat fout gaat, dus ga verder
        }
    }
    //Geef door aan welke onderdelen niet wordt voldaan
    if (badNonFunction) {
        if (result === undefined) {
            unknown.push(bro);
        }
        else if (result === false) {
            problems.push(bro);
        }
    }
    if (result === true) {
        unknown = [];
        problems = [];
    }
    return { result, unknown, problems };
};
//Kijk of iets aan een (sub)voorwaarden voldoet. Zo niet geef terug aan welke (sub)voorwaarden niet wordt voldaan.
const or = (bro, ...args) => {
    let unknown = []; //Alles wat nog onbekend is.
    let problems = []; //Alles waar niet aan wordt voldaan.
    let result = false;
    let badNonFunction = false;
    //Voor alle argumenten kijken of het een subfunctie is (die wordt uitgevoerd) of of het voldoet
    for (let arg of args) {
        if (typeof arg === "function") {
            const argResult = arg();
            arg = argResult.result;
            unknown.push(...argResult.unknown);
            problems.push(...argResult.problems);
        }
        else if (arg !== true) {
            badNonFunction = true;
        }
        if (arg === undefined) { //Informatie ontbreekt nog, dus kan nog niet goedkeuren
            result = undefined;
        }
        else if (arg === true) { //Informatie geeft aan dat er aan wordt voldaan, ongeacht de rest
            result = true;
            break; //We weten al dat het totaal goed is, dus ga niet verder.
        }
    }
    //Geef door aan welke onderdelen niet wordt voldaan
    if (badNonFunction) {
        if (result === undefined) {
            unknown.push(bro);
        }
        else if (result === false) {
            problems.push(bro);
        }
    }
    if (result === true) {
        unknown = [];
        problems = [];
    }
    return { result, unknown, problems };
};
//Kijk of iets ergens aan voldoet.
const compare = (bro, comp, a, b) => {
    let unknown = []; //Alles wat nog onbekend is.
    let problems = []; //Alles waar niet aan wordt voldaan.
    let result;
    if (typeof a === "function") {
        const tempa = a();
        a = tempa.result;
        unknown.push(...tempa.unknown);
        problems.push(...tempa.problems);
    }
    if (typeof b === "function") {
        const tempb = b();
        b = tempb.result;
        unknown.push(...tempb.unknown);
        problems.push(...tempb.problems);
    }
    if (a !== undefined && b !== undefined) {
        result = comp(a, b);
    }
    if (result === true) {
        unknown = [];
        problems = [];
    }
    else if (result === false) {
        problems.push(bro);
    }
    else {
        unknown.push(bro);
    }
    return { result, unknown, problems };
};
if (payload.jaar > 2147483647) {
    return "Ongeldig jaar.";
}
//Opleiding die wordt aangevraagt
const binaryOpleiding = Buffer.from(payload.opleiding, "hex");
const studie = (await query("SELECT", "opleidingen", "WHERE id = $1;", [binaryOpleiding])).rows[0];
if (studie === undefined) {
    return "Aangevraagde opleiding bestaat niet.";
}
//De aanvrager
const aanvrager = (await query("SELECT", "docenten", "WHERE id = $1;", [from])).rows[0];
if (aanvrager === undefined) {
    return "Vraag uw (ex-)werkgever om u als leraar toe te voegen om een subsidieaanvraag te kunnen doen.";
}
//Alle subsidies die je hebt aangevraagt (exclusief huidige aanvraag en geannnuleerde aanvragen)
const subsidies = (await query("SELECT", "subsidies", "JOIN opleidingen ON " +
    "subsidies.opleiding = opleidingen.id WHERE docent = $1 AND geannuleerd = false;", [from])).rows;
//Alle subsidies voor de huidige opleiding gesorteerd op jaar
const huidigeSubsidies = subsidies
    .filter((subsidie) => subsidie.opleiding.equals(binaryOpleiding))
    .sort((subsidie1, subsidie2) => subsidie1.jaar - subsidie2.jaar);
const vervolgAanvraag = huidigeSubsidies.length !== 0;
//Alle oude subsidies en opleidingen
const oudeSubsidies = subsidies.filter((subsidie) => !subsidie.opleiding.equals(binaryOpleiding));
const aantalOudeOpleidingen = new Set(oudeSubsidies.map((oudeSubsidie) => oudeSubsidie.opleiding)).size;
/////////////////////////////////////////////////////////////////////////////////
// B004
/////////////////////////////////////////////////////////////////////////////////
const studieVoldoet = () => and("B004.BR01", studieVoldoetOpleidingssoort, //B004.BR01.1
studieJuisteLand, //B004.BR01.2
studieJuisteStatus //B004.BR01.3
);
const studieVoldoetOpleidingssoort = () => or("B004.BR02", studie.eigenschappen.bachelor, //B004.BR02.1
studie.eigenschappen.master, //B004.BR02.2
studie.eigenschappen.deficiëntieopleiding //B004.BR02.3
);
const studieJuisteLand = () => or("B004.BR03", studie.eigenschappen.inNederland, //B004.BR03.1
studie.eigenschappen.inEU, //B004.BR03.2
studie.eigenschappen.inAruba, //B004.BR03.3
studie.eigenschappen.inSintMaarten, //B004.BR03.4
studie.eigenschappen.inCuraçao //B004.BR03.5
);
const studieJuisteStatus = () => or("B004.BR04", studie.eigenschappen.NufficGelijkwaardigVerklaardeBuitenlands, //B004.BR04.1
studie.eigenschappen.NVOgeaccrediteerd //B004.BR04.2
);
/////////////////////////////////////////////////////////////////////////////////
// B003
/////////////////////////////////////////////////////////////////////////////////
const voorwaardenAantalKeerSubsidieAangevraagd = () => {
    return and("B003.BR01", () => compare("B003.BR01.1", (a, b) => a > b, maximaalSubsiedieJaren, aantalVerstrekenSubsidiejaren()), () => compare("B003.BR01.2", (a, b) => a <= b, payload.jaar, uitersteSubsidiejaar), maximaalOpleidingenSubsidie, //B003.BR01.3
    subsidies.find((subsidie) => subsidie.jaar === payload.jaar) === undefined); //Toevoeging: Mag 1 subsidie per jaar
};
const maximaalSubsiedieJaren = () => {
    let result;
    if (studie.eigenschappen.EC !== undefined) {
        if (studie.eigenschappen.EC >= 30 && studie.eigenschappen.EC < 60) {
            result = 1;
        }
        else if (studie.eigenschappen.EC === 60) {
            result = 2;
        }
        else if (studie.eigenschappen.EC > 60) {
            result = 3;
        }
        else {
            result = 0;
        }
    }
    return { result, unknown: result === undefined ? ["B003.BR02"] : [], problems: [] };
};
const aantalVerstrekenSubsidiejaren = () => huidigeSubsidies.filter((subsidie) => and("B003.BR03", () => subsidieIsToegekent(subsidie), //B003.BR03.1
() => subsidieIsVerbruikt(subsidie) //B003.BR03.2
)).length;
const subsidieIsToegekent = (subsidie) => or("B003.BR04", subsidie !== undefined, //B003.BR04.1, subsidies worden gelijk toegekent dus bekijk toegekende subsidies
oudeSubsidies.some((opleiding) => opleiding.eigenschappen.deficiëntieopleiding === true) //B003.BR04.2
);
const subsidieIsVerbruikt = (subsidie) => and("B003.BR05", subsidie !== undefined, //B003.BR05.1, subsidies worden gelijk toegekent dus bekijk toegekende subsidies
!subsidie.geannuleerd //B003.BR05.2, we selecteren al geen geannuleerde aanvragen want 'deze hebben nooit plaatsgevonden'
);
const uitersteSubsidiejaar = () => {
    const periode = beursperiode();
    if (periode.result === undefined) {
        return periode;
    }
    else {
        const result = (vervolgAanvraag ? huidigeSubsidies[0].jaar : payload.jaar) //B003.BR06.1
            + periode.result; //B003.BR06.2
        return { result, unknown: [], problems: [] };
    }
};
const beursperiode = () => {
    let result;
    if (studie.eigenschappen.EC !== undefined) {
        if (studie.eigenschappen.EC >= 30 && studie.eigenschappen.EC < 60) {
            result = 0; //Hier heb je een off-by-one error als je het schema volgt
        }
        else if (studie.eigenschappen.EC === 60) {
            result = 3;
        }
        else if (studie.eigenschappen.EC > 60) {
            result = 5;
        }
        else {
            result = 0;
        }
    }
    return { result, unknown: result === undefined ? ["B003.BR07"] : [], problems: [] };
};
const maximaalOpleidingenSubsidie = () => or("B003.BR08", aantalOudeOpleidingen === 0, //B003.BR08.1
//Als het aantal oude opleidingen 1 is gaan alle oude subsidies over dezelfde opleiding, dus pak gewoon de eerste
aantalOudeOpleidingen !== 1 ? false : studie.eigenschappen.master === undefined ? undefined :
    studie.eigenschappen.master && oudeSubsidies[0].eigenschappen.bachelor, //B003.BR08.2
aantalOudeOpleidingen !== 1 ? false : studie.eigenschappen.master === undefined ? undefined :
    studie.eigenschappen.master && oudeSubsidies[0].eigenschappen.deficiëntieopleiding, //B003.BR08.3
false //B003.BR08.4 wordt niet meegenomen, zie issue #50
);
//B003.BR09 & B003.BR10 worden niet meegenomen, zie issue #50
/////////////////////////////////////////////////////////////////////////////////
// B002
/////////////////////////////////////////////////////////////////////////////////
const correcteAanvrager = () => and("B002.BR01", aanvrager.eigenschappen.voldoetAanBevoegdheidseisen, //B002.BR01.1
aanvrager.eigenschappen.graadBachalorVoeren, //B002.BR01.2
voorwaardenDienstverband, //B002.BR01.3
voorwaardenAantalKeerSubsidieAangevraagd, //B002.BR01.4
voorwaardenWerkzaamheden //B002.BR01.5
);
const twaalfMaandenTerug = new Date(previousBlockTimestamp);
twaalfMaandenTerug.setUTCMonth(twaalfMaandenTerug.getUTCMonth() - 12);
if (aanvrager.eigenschappen.verledenDienstverbanden === undefined) {
    aanvrager.eigenschappen.verledenDienstverbanden = [];
}
const afgelopen12MaandenWerkgevers = aanvrager.eigenschappen.verledenDienstverbanden.filter((dienstVerband) => dienstVerband.eindDatum > twaalfMaandenTerug.getTime()); //B002.BR04.2
const voorwaardenDienstverband = () => or("B002.BR02", //Zelfde als B002.BR04, zie issue #51
aanvrager.werkgever !== null, //B002.BR02.1
afgelopen12MaandenWerkgevers.length > 0 //B002.BR02.2
);
const alleWerkgevers = afgelopen12MaandenWerkgevers.map((dienstverband) => dienstverband.werkgever);
if (aanvrager.werkgever !== null) {
    alleWerkgevers.push(aanvrager.werkgever);
}
const werkgevers = (await query("SELECT", "scholen", "WHERE id = ANY($1);", [alleWerkgevers])).rows;
const voorwaardenWerkzaamheden = () => and("B002.BR03", voorwaardenRecenteWerkzaamheden, //B002.BR03.1
voorwaardenWerkindeling, //B002.BR03.2
//We kijken of er minimaal 1 voldoet, gezien de 'onderwijsWerkgever' naar meerdere kan verwijzen
() => or("B002.BR08", ...werkgevers.map((werkgever) => onderwijsWerkgeverVoldoet(werkgever))) //B002.BR03.3
);
const voorwaardenRecenteWerkzaamheden = () => or("B002.BR04", aanvrager.werkgever !== null, //B002.BR04.1
afgelopen12MaandenWerkgevers.length > 0 //B002.BR04.2
);
const voorwaardenWerkindeling = () => or("B002.BR05", voorwaardenWerktijd, //B002.BR05.1
uitgezonderdeFunctie //B002.BR05.2
);
const voorwaardenWerktijd = () => and("B002.BR06", aanvrager.eigenschappen.twintigProcentLesgebondenTaken, //B002.BR06.1
aanvrager.eigenschappen.pedagogischDidactischVerantwoordelijk //B002.BR06.2
);
const uitgezonderdeFunctie = () => or("B002.BR07", aanvrager.eigenschappen.ambulantBegeleider, //B002.BR07.1
aanvrager.eigenschappen.zorgcoördinator, //B002.BR07.2
aanvrager.eigenschappen.interneBegeleider, //B002.BR07.3
aanvrager.eigenschappen.remedialTeacher //B002.BR07.4
);
const onderwijsWerkgeverVoldoet = (werkgever) => //B002.BR08 word al in SchoolAanpassen gedaan, controleer hier alleen het resultaat
 werkgever.laatst_voldeed !== null && ( //Deze werkgever heeft ooit voldaan
werkgever.laatst_voldeed >= twaalfMaandenTerug.getTime() || //Dit was in de afgelopen 12 maanden
    werkgever.laatst_voldeed > werkgever.laatst_niet_voldeed); //Of is nog steeds het geval
/////////////////////////////////////////////////////////////////////////////////
// B006
/////////////////////////////////////////////////////////////////////////////////
let maxSubsidieBedragCenten;
//B006.BR05: Kan per jaar bedrag instellen
const maxTeVergoedenCollegegeld = (await query("SELECT", "max_vergoed_collegegeld", "WHERE jaar = $1;", [payload.jaar])).rows[0];
if (maxTeVergoedenCollegegeld !== undefined && studie.eigenschappen.collegeGeldCenten !== undefined) {
    const maxCollegeGeldCenten = Math.min(//B006.BR2
    studie.eigenschappen.collegeGeldCenten, //B006.BR2.1
    maxTeVergoedenCollegegeld.bedrag_centen //B006.BR2.2
    );
    const percentageCollegegeld = 10; //B006.BR9
    const variableVergoedingCenten = Math.round(//B006.BR6
    studie.eigenschappen.collegeGeldCenten * //B006.BR6.1
        percentageCollegegeld / 100); //B006.BR6.2
    const maxVergoedeReiskostenCenten = 350 * 100; //B006.BR8
    const maxReiskostenCenten = Math.min(//B006.BR4
    variableVergoedingCenten, //B006.BR4.1
    maxVergoedeReiskostenCenten //B006.BR4.2
    );
    const maxVergoedeStudiemiddelenCenten = 350 * 100; //B006.BR7
    const maxStudieMiddelenCenten = Math.min(//B006.BR3
    variableVergoedingCenten, //B006.BR3.1
    maxVergoedeStudiemiddelenCenten //B006.BR3.2
    );
    maxSubsidieBedragCenten = maxCollegeGeldCenten + maxReiskostenCenten + maxStudieMiddelenCenten; //B006.BR1;
}
/////////////////////////////////////////////////////////////////////////////////
// B101
/////////////////////////////////////////////////////////////////////////////////
//B001.BR01: beschikbare budget begint als subsidieplafond, wordt telkens verlaagt als subsidie wordt toegekent
const budget = (await query("SELECT", "budget", "WHERE jaar = $1 AND sector = $2;", [payload.jaar, aanvrager.eigenschappen.sector])).rows[0];
const beschikbareBudgetCenten = () => {
    let result;
    if (budget !== undefined) {
        if (vervolgAanvraag) {
            //Is een vervolg aanvraag, volledige budget is beschikbaar (- wat is uitgegeven)
            result = budget.beschikbaar_totaal_centen - budget.uitgegeven_totaal_centen;
        }
        else {
            //Is een nieuwe aanvraag, vervolg budget van het totaal af halen
            result = (budget.beschikbaar_totaal_centen - budget.beschikbaar_vervolg_centen) -
                //Gedeelte wat niet al is uitgegeven, maar alleen voor vervolg beschikbaar is.
                (budget.uitgegeven_totaal_centen - budget.uitgegeven_vervolg_centen);
        }
    }
    return { result, unknown: result === undefined ? ["B001.BR01"] : [], problems: [] };
};
/////////////////////////////////////////////////////////////////////////////////
// Resultaat
/////////////////////////////////////////////////////////////////////////////////
//Later zal hier nog een check bij moeten of er nog genoeg geld beschikbaar is, etc.
const toewijzen = and("B008.BR02", payload.jaar >= new Date(previousBlockTimestamp).getUTCFullYear(), //B008.BR02.1: B001
correcteAanvrager, //B008.BR02.2: B002
studieVoldoet, //B008.BR02.3: B004
//B008.BR02.4: Andere regeling wordt niet meegenomen, zie issue #50
() => compare("B008.BR02.5", (a, b) => a >= b, beschikbareBudgetCenten, maxSubsidieBedragCenten) //B008.BR02.5: B006 & B101
);
if (toewijzen.result === false) {
    //De aanvraag is afgewezen om de volgende redenen:
    return `Afgewezen: ${Array.from(new Set(toewijzen.problems)).toString()}`;
}
else if (toewijzen.result === undefined) {
    //De volgende informatie is nog onbekend, dus kan nog niet worden goedgekeurd:
    return `Ontbreekt: ${Array.from(new Set(toewijzen.unknown)).toString()}`;
}
else {
    //De aanvraag is goedgekeurd
    await query("INSERT", "subsidies", "(docent, opleiding, jaar, aanvraag_tijd, bedrag_centen, sector) VALUES ($1, $2, $3, $4, $5, $6);", [from, binaryOpleiding, payload.jaar, previousBlockTimestamp, maxSubsidieBedragCenten, aanvrager.eigenschappen.sector]);
    await query("UPDATE", "budget", "SET uitgegeven_totaal_centen = uitgegeven_totaal_centen + $3, " +
        "uitgegeven_vervolg_centen = GREATEST(uitgegeven_vervolg_centen + $4, beschikbaar_vervolg_centen) WHERE jaar = $1 AND sector = $2;", [payload.jaar, aanvrager.eigenschappen.sector, maxSubsidieBedragCenten, vervolgAanvraag ? maxSubsidieBedragCenten : 0]);
    return "OK";
}